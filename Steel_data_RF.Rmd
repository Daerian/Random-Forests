---
title: "A look into the applications of random forest for the steel dataset"
author: "Zong Li"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Import necessary packages:
```{r, echo = FALSE, message=FALSE, warning=FALSE}
source("randomforest.R")
library(dplyr)
library(tidyverse)
library(rpart)
library(rpart.plot)
set.seed(1)
```

Read data. The parameter names and the data itself is in two separate files;
we need to first read in the data then set set the column names using the file 
containing the parameter names. Keep one dependent variables to classify, remove 
the other dependent variables.
```{r, include=FALSE}
data_file <- "Faults.NNA"
headers_file <- "Faults27x7_var.txt"
data <- read.table(data_file, sep = "" , header = F, na.strings ="", 
                   stringsAsFactors= F)
data_headers <- scan(headers_file, what="", sep="\n")
colnames(data) <- data_headers

#Type of dependent variables (7 Types of Steel Plates Faults): 
#1.Pastry
#2.Z_Scratch 
#3.K_Scatch 
#4.Stains 
#5.Dirtiness 
#6.Bumps 
#7.Other_Faults
# change the values of the other categories to correspond the number of the type of steel fault
data=subset(data,select=-c(Other_Faults))
labels = subset(data, select=c("Pastry", "Z_Scratch", "K_Scatch", "Stains", "Dirtiness", "Bumps"))

data <- (data[complete.cases(data),])
# now to make the categories into one columns
Fault_Type = names(labels)[max.col(labels == 1L)]
to_remove <- c("Pastry", "Z_Scratch", "K_Scatch", "Stains", "Dirtiness", "Bumps")
data <- data[ , !(names(data) %in% to_remove)]
data = cbind(data,Fault_Type)

data = within(data, Fault_Type <- factor(Fault_Type, labels = c(6,5,3,1,4,2)))
```

Clean data and make column names string-friendly
```{r, include=FALSE}
#Purge rows containing N/A entries
data <- (data[complete.cases(data),])

# Remove spaces from column names
names(data) = gsub(" ","_", names(data))
```

 Permutate data and Split data into training and testing sets with a 7:3 ratio and replacement
```{r, include=FALSE}
# first permutate the data because the data needs to be random

data<- data[sample(nrow(data)),]
split = sample(2, nrow(data), prob=c(0.7,0.3), replace=TRUE)
train_subset = data[split==1,]
test_subset = data[split==2,]
```


```{r, warning=FALSE}
train_labels = as.factor(unlist(train_subset[ncol(train_subset)]))#training_set labels
test_labels = as.factor(unlist(test_subset[ncol(test_subset)]))# testing_set Labels
train_subset = train_subset[,-ncol(train_subset)] #getting rid of the labels to  prepare
# To perform classification
test_subset = test_subset[,-ncol(test_subset)]
num_vars = 5
num_trees = 800
#function(Df, labels, Df2, labels2, num_trees, num_vars, ctrl = "None")
f = PerformClassification(train_subset,train_labels,test_subset,test_labels,num_trees,num_vars, ctrl = "None")
```
